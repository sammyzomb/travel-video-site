
<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>航向世界旅遊頻道</title>
  <!-- 省略部分 CSS（與原始相同） -->
</head>
<body>
  <!-- 省略 navbar + hero 結構 -->

  <section class="video-section">
    <h2 style="font-size:1.8rem; margin-bottom:24px; color:#222;">精選節目推薦</h2>
    <div class="video-grid" id="featured-videos"></div>
  </section>

  <script src="https://www.youtube.com/iframe_api"></script>
  <script>
    let videos = [], current = 0, player;
    let ytIdToIndex = {};

    fetch('hero.json')
      .then(res => res.json())
      .then(data => {
        videos = data;
        videos.forEach((v, i) => ytIdToIndex[v.id] = i);
        initHero();
      });

    function initHero() {
      if (window.YT && window.YT.Player) {
        onYouTubeIframeAPIReady();
      } else {
        window.onYouTubeIframeAPIReady = onYouTubeIframeAPIReady;
      }
    }

    function onYouTubeIframeAPIReady() {
      player = new YT.Player('ytPlayer', {
        videoId: videos[0].id,
        playerVars: {
          autoplay: 1, mute: 1, controls: 0, rel: 0, showinfo: 0,
          modestbranding: 1, loop: 1,
          playlist: videos.map(v => v.id).join(',')
        },
        events: {
          onReady: e => {
            e.target.mute();
            e.target.setPlaybackQuality('hd2160');
            e.target.playVideo();
            updateCaption(0);
          },
          onStateChange: onPlayerStateChange
        }
      });
    }

    function onPlayerStateChange(event) {
      const mask = document.getElementById('heroMask');
      if (event.data === YT.PlayerState.BUFFERING) {
        mask.classList.add('show');
      } else if (event.data === YT.PlayerState.PLAYING) {
        mask.classList.remove('show');
        const vid = player.getVideoData().video_id;
        if (ytIdToIndex.hasOwnProperty(vid)) {
          current = ytIdToIndex[vid];
          updateCaption(current);
        }
      }
    }

    function updateCaption(idx) {
      const cap = document.getElementById('heroCaption');
      if (videos[idx]) {
        cap.innerHTML = `<div class="cap-title">${videos[idx].title || ''}</div>
                         <div class="cap-desc">${videos[idx].desc || ''}</div>`;
        cap.classList.add('visible');
      }
    }

    // ✅ 修正：使用自訂圖片 image 欄位
    fetch("featured_updated.json")
      .then(res => res.json())
      .then(data => {
        const container = document.getElementById("featured-videos");
        data.forEach(video => {
          const card = document.createElement("div");
          card.className = "video-card";

          const thumb = video.image ? video.image : `https://img.youtube.com/vi/${video.youtubeId}/hqdefault.jpg`;

          card.innerHTML = `
            <div class="video-thumb">
              <img src="${thumb}" alt="${video.title}">
            </div>
            <div class="video-content">
              <div class="video-tags">${video.tags.join(' / ')}</div>
              <div class="video-title">${video.title}</div>
              <div class="video-desc">${video.description}</div>
              <a href="https://www.youtube.com/watch?v=${video.youtubeId}" target="_blank" class="video-cta">${video.cta}</a>
            </div>
          `;
          container.appendChild(card);
        });
      });
  </script>
</body>
</html>
