<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>æ­¸æª”ç®¡ç† - èˆªå‘ä¸–ç•Œæ—…éŠé »é“</title>
  <script src="https://cdn.jsdelivr.net/npm/contentful@latest/dist/contentful.browser.min.js"></script>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; background: #f5f5f5; }
    .container { max-width: 1400px; margin: 0 auto; padding: 20px; }
    
    .header { background: white; padding: 20px; border-radius: 10px; margin-bottom: 20px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
    .header h1 { color: #2b71d2; margin-bottom: 10px; }
    .header p { color: #666; }
    
    .admin-panel { background: white; padding: 20px; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
    
    .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-bottom: 30px; }
    .stat-card { background: #f8f9fa; padding: 20px; border-radius: 8px; text-align: center; border-left: 4px solid #2b71d2; }
    .stat-number { font-size: 2rem; font-weight: bold; color: #2b71d2; }
    .stat-label { color: #666; margin-top: 5px; }
    
    .controls { display: flex; gap: 15px; margin-bottom: 20px; flex-wrap: wrap; }
    .btn { background: #2b71d2; color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer; font-size: 14px; }
    .btn:hover { background: #1e5bb8; }
    .btn-secondary { background: #6c757d; }
    .btn-secondary:hover { background: #5a6268; }
    .btn-success { background: #28a745; }
    .btn-success:hover { background: #218838; }
    .btn-warning { background: #ffc107; color: #212529; }
    .btn-warning:hover { background: #e0a800; }
    
    .filter-section { background: #f8f9fa; padding: 15px; border-radius: 8px; margin-bottom: 20px; }
    .filter-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; }
    .form-group { margin-bottom: 10px; }
    .form-group label { display: block; margin-bottom: 5px; font-weight: 600; color: #333; }
    .form-group select, .form-group input { width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px; font-size: 14px; }
    
    .programs-table { width: 100%; border-collapse: collapse; margin-top: 20px; }
    .programs-table th, .programs-table td { padding: 12px; text-align: left; border-bottom: 1px solid #eee; }
    .programs-table th { background: #f8f9fa; font-weight: 600; color: #333; }
    .programs-table tr:hover { background: #f8f9fa; }
    
    .program-thumbnail { width: 80px; height: 60px; object-fit: cover; border-radius: 4px; }
    .program-title { font-weight: 600; color: #333; }
    .program-meta { font-size: 12px; color: #666; }
    .program-stats { display: flex; gap: 10px; font-size: 12px; }
    .program-actions { display: flex; gap: 5px; }
    .btn-small { padding: 5px 10px; font-size: 12px; }
    
    .status { padding: 10px; border-radius: 5px; margin-bottom: 15px; }
    .status.success { background: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
    .status.error { background: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
    .status.info { background: #d1ecf1; color: #0c5460; border: 1px solid #bee5eb; }
    
    .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 1000; }
    .modal-content { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); background: white; padding: 30px; border-radius: 10px; width: 90%; max-width: 600px; max-height: 80vh; overflow-y: auto; }
    .modal-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
    .modal-close { background: none; border: none; font-size: 1.5rem; cursor: pointer; color: #666; }
    
    .pagination { display: flex; justify-content: center; gap: 10px; margin-top: 20px; }
    .pagination button { padding: 8px 12px; border: 1px solid #ddd; background: white; cursor: pointer; }
    .pagination button.active { background: #2b71d2; color: white; border-color: #2b71d2; }
    .pagination button:hover:not(.active) { background: #f8f9fa; }
    
    .loading { text-align: center; padding: 40px; color: #666; }
    .empty { text-align: center; padding: 60px; color: #666; }
    
    .user-info { 
      background: #e3f2fd; 
      padding: 10px 15px; 
      border-radius: 5px; 
      margin-bottom: 15px; 
      display: flex; 
      justify-content: space-between; 
      align-items: center;
    }
    .user-info .user-details { color: #1976d2; font-weight: 500; }
    .user-info .logout-btn { 
      background: #f44336; 
      color: white; 
      border: none; 
      padding: 5px 10px; 
      border-radius: 3px; 
      cursor: pointer; 
      font-size: 12px;
    }
    .user-info .logout-btn:hover { background: #d32f2f; }
    
    @media (max-width: 768px) {
      .controls { flex-direction: column; }
      .filter-grid { grid-template-columns: 1fr; }
      .programs-table { font-size: 12px; }
      .programs-table th, .programs-table td { padding: 8px; }
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <h1>ğŸ“º æ­¸æª”ç®¡ç†ç³»çµ±</h1>
      <p>ç®¡ç†å·²æ’­å‡ºçš„ç¯€ç›®æ­¸æª”ï¼Œæ”¯æ´åˆ†é¡ã€æ¨™ç±¤å’Œçµ±è¨ˆåˆ†æ</p>
      <div style="margin-top: 15px;">
        <a href="admin-dashboard.html" class="btn btn-secondary" style="text-decoration: none; display: inline-block;">
          ğŸ  è¿”å›ä¸»æ§å°
        </a>
      </div>
    </div>
    
    <!-- ç”¨æˆ¶è³‡è¨Šé¡¯ç¤º -->
    <div class="user-info" id="userInfo" style="display: none;">
      <div class="user-details" id="userDetails"></div>
      <button class="logout-btn" onclick="logout()">ç™»å‡º</button>
    </div>
    
    <div class="admin-panel">
      <div id="status" class="status" style="display: none;"></div>
      
      <!-- çµ±è¨ˆé¢æ¿ -->
      <div class="stats-grid">
        <div class="stat-card">
          <div class="stat-number" id="total-programs">0</div>
          <div class="stat-label">ç¸½ç¯€ç›®æ•¸</div>
        </div>
        <div class="stat-card">
          <div class="stat-number" id="total-views">0</div>
          <div class="stat-label">ç¸½è§€çœ‹æ¬¡æ•¸</div>
        </div>
        <div class="stat-card">
          <div class="stat-number" id="avg-rating">0.0</div>
          <div class="stat-label">å¹³å‡è©•åˆ†</div>
        </div>
        <div class="stat-card">
          <div class="stat-number" id="total-favorites">0</div>
          <div class="stat-label">ç¸½æ”¶è—æ•¸</div>
        </div>
      </div>
      
      <!-- æ§åˆ¶æŒ‰éˆ• -->
      <div class="controls">
        <button class="btn" onclick="loadArchivedPrograms()">ğŸ”„ é‡æ–°è¼‰å…¥</button>
        <button class="btn btn-success" onclick="runAutoArchive()">âš¡ åŸ·è¡Œè‡ªå‹•æ­¸æª”</button>
        <button class="btn btn-warning" onclick="exportData()">ğŸ“Š åŒ¯å‡ºè³‡æ–™</button>
        <button class="btn btn-secondary" onclick="showBulkEdit()">âœï¸ æ‰¹é‡ç·¨è¼¯</button>
      </div>
      
      <!-- ç¯©é¸å™¨ -->
      <div class="filter-section">
        <h3 style="margin-bottom: 15px;">ğŸ” ç¯©é¸ç¯€ç›®</h3>
        <div class="filter-grid">
          <div class="form-group">
            <label>åœ‹å®¶/åœ°å€</label>
            <select id="filter-country">
              <option value="">å…¨éƒ¨åœ‹å®¶</option>
              <option value="æ—¥æœ¬">æ—¥æœ¬</option>
              <option value="éŸ“åœ‹">éŸ“åœ‹</option>
              <option value="æ³°åœ‹">æ³°åœ‹</option>
              <option value="æ³•åœ‹">æ³•åœ‹</option>
              <option value="ç¾©å¤§åˆ©">ç¾©å¤§åˆ©</option>
              <option value="å…¶ä»–">å…¶ä»–</option>
            </select>
          </div>
          <div class="form-group">
            <label>ç¯€ç›®åˆ†é¡</label>
            <select id="filter-category">
              <option value="">å…¨éƒ¨åˆ†é¡</option>
              <option value="äºæ´²æ—…éŠ">äºæ´²æ—…éŠ</option>
              <option value="æ­æ´²æ—…éŠ">æ­æ´²æ—…éŠ</option>
              <option value="ç¾é£Ÿæ—…éŠ">ç¾é£Ÿæ—…éŠ</option>
              <option value="å…¶ä»–">å…¶ä»–</option>
            </select>
          </div>
          <div class="form-group">
            <label>ç¯€ç›®ç‹€æ…‹</label>
            <select id="filter-status">
              <option value="">å…¨éƒ¨ç‹€æ…‹</option>
              <option value="archived">å·²æ­¸æª”</option>
              <option value="popular">ç†±é–€</option>
              <option value="recommended">æ¨è–¦</option>
            </select>
          </div>
          <div class="form-group">
            <label>æœ€ä½è©•åˆ†</label>
            <select id="filter-rating">
              <option value="0">å…¨éƒ¨è©•åˆ†</option>
              <option value="1">1æ˜Ÿä»¥ä¸Š</option>
              <option value="2">2æ˜Ÿä»¥ä¸Š</option>
              <option value="3">3æ˜Ÿä»¥ä¸Š</option>
              <option value="4">4æ˜Ÿä»¥ä¸Š</option>
              <option value="5">5æ˜Ÿ</option>
            </select>
          </div>
        </div>
        <div style="margin-top: 15px;">
          <button class="btn" onclick="applyFilters()">å¥—ç”¨ç¯©é¸</button>
          <button class="btn btn-secondary" onclick="clearFilters()">æ¸…é™¤ç¯©é¸</button>
        </div>
      </div>
      
      <!-- ç¯€ç›®åˆ—è¡¨ -->
      <div id="programs-container">
        <div class="loading">è¼‰å…¥ä¸­...</div>
      </div>
    </div>
  </div>
  
  <!-- ç·¨è¼¯ç¯€ç›®æ¨¡æ…‹æ¡† -->
  <div id="editModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h3>ç·¨è¼¯ç¯€ç›®</h3>
        <button class="modal-close" onclick="closeModal()">&times;</button>
      </div>
      <form id="editForm">
        <div class="form-group">
          <label>ç¯€ç›®æ¨™é¡Œ</label>
          <input type="text" id="edit-title" required>
        </div>
        <div class="form-group">
          <label>åœ‹å®¶/åœ°å€</label>
          <select id="edit-country" required>
            <option value="æ—¥æœ¬">æ—¥æœ¬</option>
            <option value="éŸ“åœ‹">éŸ“åœ‹</option>
            <option value="æ³°åœ‹">æ³°åœ‹</option>
            <option value="æ³•åœ‹">æ³•åœ‹</option>
            <option value="ç¾©å¤§åˆ©">ç¾©å¤§åˆ©</option>
            <option value="å…¶ä»–">å…¶ä»–</option>
          </select>
        </div>
        <div class="form-group">
          <label>ç¯€ç›®åˆ†é¡</label>
          <select id="edit-category" required>
            <option value="äºæ´²æ—…éŠ">äºæ´²æ—…éŠ</option>
            <option value="æ­æ´²æ—…éŠ">æ­æ´²æ—…éŠ</option>
            <option value="ç¾é£Ÿæ—…éŠ">ç¾é£Ÿæ—…éŠ</option>
            <option value="å…¶ä»–">å…¶ä»–</option>
          </select>
        </div>
        <div class="form-group">
          <label>å­åˆ†é¡</label>
          <select id="edit-subcategory">
            <option value="ç¾é£Ÿ">ç¾é£Ÿ</option>
            <option value="æ–‡åŒ–">æ–‡åŒ–</option>
            <option value="è‡ªç„¶">è‡ªç„¶</option>
            <option value="è—è¡“">è—è¡“</option>
            <option value="å…¶ä»–">å…¶ä»–</option>
          </select>
        </div>
        <div class="form-group">
          <label>ç¯€ç›®ç‹€æ…‹</label>
          <select id="edit-status" required>
            <option value="archived">å·²æ­¸æª”</option>
            <option value="popular">ç†±é–€</option>
            <option value="recommended">æ¨è–¦</option>
          </select>
        </div>
        <div class="form-group">
          <label>è©•åˆ†</label>
          <input type="number" id="edit-rating" min="0" max="5" step="0.1">
        </div>
        <div class="form-group">
          <label>è§€çœ‹æ¬¡æ•¸</label>
          <input type="number" id="edit-views" min="0">
        </div>
        <div class="form-group">
          <label>æ”¶è—æ¬¡æ•¸</label>
          <input type="number" id="edit-favorites" min="0">
        </div>
        <div class="form-group">
          <label>å‚™è¨»</label>
          <textarea id="edit-notes" rows="3"></textarea>
        </div>
        <div style="margin-top: 20px;">
          <button type="submit" class="btn">ä¿å­˜è®Šæ›´</button>
          <button type="button" class="btn btn-secondary" onclick="closeModal()">å–æ¶ˆ</button>
        </div>
      </form>
    </div>
  </div>

  <script>
    // çµ±ä¸€çš„è³‡æ–™ç®¡ç†
    const DATA_KEYS = {
      PROGRAMS: 'tv_programs_data',
      ARCHIVES: 'tv_archives_data',
      TEMPLATES: 'tv_templates_data'
    };
    
    let allPrograms = [];
    let archivedPrograms = [];
    
    // è¼‰å…¥æ‰€æœ‰ç¯€ç›®è³‡æ–™
    function loadAllPrograms() {
      try {
        const savedData = localStorage.getItem(DATA_KEYS.PROGRAMS);
        if (savedData) {
          allPrograms = JSON.parse(savedData);
          console.log(`æ­¸æª”ç®¡ç†ï¼šå·²è¼‰å…¥ ${allPrograms.length} å€‹ç¯€ç›®è³‡æ–™`);
        }
        
        const savedArchives = localStorage.getItem(DATA_KEYS.ARCHIVES);
        if (savedArchives) {
          archivedPrograms = JSON.parse(savedArchives);
          console.log(`æ­¸æª”ç®¡ç†ï¼šå·²è¼‰å…¥ ${archivedPrograms.length} å€‹æ­¸æª”ç¯€ç›®`);
        }
        
        updateStats();
        displayArchivedPrograms();
      } catch (error) {
        console.error('è¼‰å…¥ç¯€ç›®è³‡æ–™å¤±æ•—:', error);
      }
    }
    
    // å„²å­˜æ­¸æª”è³‡æ–™
    function saveArchivedPrograms() {
      try {
        localStorage.setItem(DATA_KEYS.ARCHIVES, JSON.stringify(archivedPrograms));
        console.log(`æ­¸æª”ç®¡ç†ï¼šå·²å„²å­˜ ${archivedPrograms.length} å€‹æ­¸æª”ç¯€ç›®`);
        
        // è§¸ç™¼è‡ªå®šç¾©äº‹ä»¶ï¼Œé€šçŸ¥å…¶ä»–ç³»çµ±è³‡æ–™å·²æ›´æ–°
        const event = new CustomEvent('archivesDataUpdated', {
          detail: { archives: archivedPrograms }
        });
        window.dispatchEvent(event);
        
        return archivedPrograms;
      } catch (error) {
        console.error('å„²å­˜æ­¸æª”è³‡æ–™å¤±æ•—:', error);
        return [];
      }
    }
    
    // æ›´æ–°çµ±è¨ˆè³‡è¨Š
    function updateStats() {
      const today = new Date().toISOString().split('T')[0];
      
      // è¨ˆç®—å·²æ’­å‡ºç¯€ç›®ï¼ˆä»Šå¤©ä¹‹å‰çš„ç¯€ç›®ï¼‰
      const pastPrograms = allPrograms.filter(p => p.airDate < today);
      
      // è¨ˆç®—æœªæ’­å‡ºç¯€ç›®ï¼ˆä»Šå¤©åŠä¹‹å¾Œçš„ç¯€ç›®ï¼‰
      const futurePrograms = allPrograms.filter(p => p.airDate >= today);
      
      // æ›´æ–°çµ±è¨ˆå¡ç‰‡
      document.getElementById('totalPrograms').textContent = allPrograms.length;
      document.getElementById('archivedPrograms').textContent = archivedPrograms.length;
      document.getElementById('pastPrograms').textContent = pastPrograms.length;
      document.getElementById('futurePrograms').textContent = futurePrograms.length;
    }
    
    // é¡¯ç¤ºæ­¸æª”ç¯€ç›®
    function displayArchivedPrograms() {
      const container = document.getElementById('archivedProgramsList');
      if (!container) return;
      
      if (archivedPrograms.length === 0) {
        container.innerHTML = '<p style="text-align: center; color: #666; padding: 20px;">ç›®å‰æ²’æœ‰æ­¸æª”ç¯€ç›®</p>';
        return;
      }
      
      // æŒ‰æ—¥æœŸæ’åº
      const sortedArchives = archivedPrograms.sort((a, b) => new Date(b.airDate) - new Date(a.airDate));
      
      container.innerHTML = sortedArchives.map(program => `
        <tr>
          <td>
            <img src="${program.thumbnail || 'https://picsum.photos/80/60'}" alt="${program.title}" class="program-thumbnail">
          </td>
          <td>
            <div class="program-title">${program.title}</div>
            <div class="program-meta">${program.category} | ${program.status}</div>
          </td>
          <td>${program.airDate}</td>
          <td>${program.airTime}</td>
          <td>${program.duration}åˆ†é˜</td>
          <td>
            <div class="program-actions">
              <button class="btn btn-small btn-success" onclick="restoreProgram('${program.airDate}-${program.airTime}')">é‚„åŸ</button>
              <button class="btn btn-small btn-danger" onclick="deleteArchive('${program.airDate}-${program.airTime}')">æ°¸ä¹…åˆªé™¤</button>
            </div>
          </td>
        </tr>
      `).join('');
    }
    
    // æ­¸æª”ç¯€ç›®
    function archiveProgram(slotKey) {
      const program = allPrograms.find(p => `${p.airDate}-${p.airTime}` === slotKey);
      if (program) {
        // æ·»åŠ åˆ°æ­¸æª”åˆ—è¡¨
        archivedPrograms.push({
          ...program,
          archivedAt: new Date().toISOString(),
          archivedBy: currentUser.email
        });
        
        // å¾ç¯€ç›®åˆ—è¡¨ä¸­ç§»é™¤
        allPrograms = allPrograms.filter(p => `${p.airDate}-${p.airTime}` !== slotKey);
        
        // å„²å­˜è³‡æ–™
        localStorage.setItem(DATA_KEYS.PROGRAMS, JSON.stringify(allPrograms));
        saveArchivedPrograms();
        
        updateStats();
        displayArchivedPrograms();
        showStatus('ç¯€ç›®å·²æ­¸æª”', 'success');
      }
    }
    
    // é‚„åŸç¯€ç›®
    function restoreProgram(slotKey) {
      const program = archivedPrograms.find(p => `${p.airDate}-${p.airTime}` === slotKey);
      if (program) {
        // å¾æ­¸æª”åˆ—è¡¨ä¸­ç§»é™¤
        archivedPrograms = archivedPrograms.filter(p => `${p.airDate}-${p.airTime}` !== slotKey);
        
        // æ·»åŠ å›ç¯€ç›®åˆ—è¡¨
        allPrograms.push(program);
        
        // å„²å­˜è³‡æ–™
        localStorage.setItem(DATA_KEYS.PROGRAMS, JSON.stringify(allPrograms));
        saveArchivedPrograms();
        
        updateStats();
        displayArchivedPrograms();
        showStatus('ç¯€ç›®å·²é‚„åŸ', 'success');
      }
    }
    
    // æ°¸ä¹…åˆªé™¤æ­¸æª”
    function deleteArchive(slotKey) {
      if (confirm('ç¢ºå®šè¦æ°¸ä¹…åˆªé™¤é€™å€‹æ­¸æª”ç¯€ç›®å—ï¼Ÿæ­¤æ“ä½œç„¡æ³•å¾©åŸã€‚')) {
        archivedPrograms = archivedPrograms.filter(p => `${p.airDate}-${p.airTime}` !== slotKey);
        saveArchivedPrograms();
        updateStats();
        displayArchivedPrograms();
        showStatus('æ­¸æª”å·²æ°¸ä¹…åˆªé™¤', 'success');
      }
    }
    
    // ç›£è½å…¶ä»–ç³»çµ±çš„è³‡æ–™æ›´æ–°
    window.addEventListener('programsDataUpdated', function(event) {
      console.log('æ­¸æª”ç®¡ç†ï¼šæ”¶åˆ°ç¯€ç›®è³‡æ–™æ›´æ–°é€šçŸ¥');
      loadAllPrograms();
    });
    
    // ç™»å…¥é©—è­‰æª¢æŸ¥
    function checkAuth() {
      const user = sessionStorage.getItem('adminUser');
      const loginTime = sessionStorage.getItem('loginTime');
      
      if (!user || !loginTime) {
        // æœªç™»å…¥ï¼Œè·³è½‰åˆ°ç™»å…¥é é¢
        window.location.href = 'admin-login.html';
        return null;
      }
      
      // æª¢æŸ¥ç™»å…¥æ˜¯å¦è¶…é 8 å°æ™‚
      const loginDate = new Date(loginTime);
      const now = new Date();
      const hoursDiff = (now - loginDate) / (1000 * 60 * 60);
      
      if (hoursDiff >= 8) {
        // ç™»å…¥å·²éæœŸï¼Œæ¸…é™¤ session ä¸¦è·³è½‰åˆ°ç™»å…¥é é¢
        sessionStorage.removeItem('adminUser');
        sessionStorage.removeItem('loginTime');
        window.location.href = 'admin-login.html';
        return null;
      }
      
      return JSON.parse(user);
    }
    
    // ç™»å‡ºåŠŸèƒ½
    function logout() {
      sessionStorage.removeItem('adminUser');
      sessionStorage.removeItem('loginTime');
      window.location.href = 'admin-login.html';
    }
    
    // æ›´æ–°ç”¨æˆ¶è³‡è¨Šé¡¯ç¤º
    function updateUserInfo() {
      const userInfo = document.getElementById('userInfo');
      const userDetails = document.getElementById('userDetails');
      
      if (currentUser) {
        userInfo.style.display = 'flex';
        userDetails.innerHTML = `æ­¡è¿ï¼Œ${currentUser.name} (${currentUser.role}) | <span style="color: #2b71d2; font-weight: 600;">v1.2.0 (2025/08/28 10:35:00)</span>`;
      }
    }
    
    // å…¨åŸŸè®Šæ•¸
    let currentUser = null;
    let archivedPrograms = [];
    let filteredPrograms = [];
    let currentPage = 1;
    const itemsPerPage = 20;
    
    // åˆå§‹åŒ–
    document.addEventListener('DOMContentLoaded', function() {
      // æª¢æŸ¥ç”¨æˆ¶ç™»å…¥ç‹€æ…‹
      currentUser = checkAuth();
      if (!currentUser) return;
      
      // æ›´æ–°ç”¨æˆ¶è³‡è¨Šé¡¯ç¤º
      updateUserInfo();
      
      // è¼‰å…¥æ­¸æª”ç¯€ç›®
      loadArchivedPrograms();
    });
    
    // è¼‰å…¥æ­¸æª”ç¯€ç›®
    async function loadArchivedPrograms() {
      try {
        showStatus('è¼‰å…¥ä¸­...', 'info');
        
        // é€™è£¡æ‡‰è©²èª¿ç”¨æ‚¨çš„ Contentful API
        // æš«æ™‚ä½¿ç”¨æ¨¡æ“¬æ•¸æ“š
        const mockData = generateMockData();
        archivedPrograms = mockData;
        filteredPrograms = [...archivedPrograms];
        
        updateStatistics();
        renderPrograms();
        showStatus('è¼‰å…¥å®Œæˆ', 'success');
      } catch (error) {
        console.error('è¼‰å…¥å¤±æ•—:', error);
        showStatus('è¼‰å…¥å¤±æ•—: ' + error.message, 'error');
      }
    }
    
    // ç”Ÿæˆæ¨¡æ“¬æ•¸æ“š
    function generateMockData() {
      const countries = ['æ—¥æœ¬', 'éŸ“åœ‹', 'æ³°åœ‹', 'æ³•åœ‹', 'ç¾©å¤§åˆ©'];
      const categories = ['äºæ´²æ—…éŠ', 'æ­æ´²æ—…éŠ', 'ç¾é£Ÿæ—…éŠ'];
      const subcategories = ['ç¾é£Ÿ', 'æ–‡åŒ–', 'è‡ªç„¶', 'è—è¡“'];
      const statuses = ['archived', 'popular', 'recommended'];
      
      const programs = [];
      for (let i = 1; i <= 50; i++) {
        programs.push({
          id: `program-${i}`,
          title: `æ—…éŠç¯€ç›® ${i} - ${countries[i % countries.length]}`,
          country: countries[i % countries.length],
          category: categories[i % categories.length],
          subCategory: subcategories[i % subcategories.length],
          status: statuses[i % statuses.length],
          rating: Math.floor(Math.random() * 5) + 1,
          viewCount: Math.floor(Math.random() * 10000),
          favoriteCount: Math.floor(Math.random() * 500),
          airDate: new Date(Date.now() - Math.random() * 365 * 24 * 60 * 60 * 1000).toISOString(),
          videoId: `video${i}`,
          thumbnail: `https://img.youtube.com/vi/video${i}/mqdefault.jpg`
        });
      }
      return programs;
    }
    
    // æ›´æ–°çµ±è¨ˆæ•¸æ“š
    function updateStatistics() {
      const stats = {
        total: archivedPrograms.length,
        totalViews: archivedPrograms.reduce((sum, p) => sum + p.viewCount, 0),
        totalFavorites: archivedPrograms.reduce((sum, p) => sum + p.favoriteCount, 0),
        avgRating: archivedPrograms.reduce((sum, p) => sum + p.rating, 0) / archivedPrograms.length
      };
      
      document.getElementById('total-programs').textContent = stats.total;
      document.getElementById('total-views').textContent = stats.totalViews.toLocaleString();
      document.getElementById('avg-rating').textContent = stats.avgRating.toFixed(1);
      document.getElementById('total-favorites').textContent = stats.totalFavorites.toLocaleString();
    }
    
    // æ¸²æŸ“ç¯€ç›®åˆ—è¡¨
    function renderPrograms() {
      const container = document.getElementById('programs-container');
      const startIndex = (currentPage - 1) * itemsPerPage;
      const endIndex = startIndex + itemsPerPage;
      const pagePrograms = filteredPrograms.slice(startIndex, endIndex);
      
      if (pagePrograms.length === 0) {
        container.innerHTML = '<div class="empty">æ²’æœ‰æ‰¾åˆ°ç¬¦åˆæ¢ä»¶çš„ç¯€ç›®</div>';
        return;
      }
      
      let html = `
        <table class="programs-table">
          <thead>
            <tr>
              <th>ç¸®åœ–</th>
              <th>ç¯€ç›®è³‡è¨Š</th>
              <th>åˆ†é¡</th>
              <th>çµ±è¨ˆ</th>
              <th>ç‹€æ…‹</th>
              <th>æ“ä½œ</th>
            </tr>
          </thead>
          <tbody>
      `;
      
      pagePrograms.forEach(program => {
        html += `
          <tr>
            <td>
              <img src="${program.thumbnail}" alt="${program.title}" class="program-thumbnail">
            </td>
            <td>
              <div class="program-title">${program.title}</div>
              <div class="program-meta">æ’­å‡ºæ—¥æœŸ: ${new Date(program.airDate).toLocaleDateString('zh-TW')}</div>
            </td>
            <td>
              <div>${program.country}</div>
              <div class="program-meta">${program.category} - ${program.subCategory}</div>
            </td>
            <td>
              <div class="program-stats">
                <span>â­ ${program.rating}</span>
                <span>ğŸ‘ï¸ ${program.viewCount}</span>
                <span>â¤ï¸ ${program.favoriteCount}</span>
              </div>
            </td>
            <td>
              <span class="status-badge ${program.status}">${getStatusText(program.status)}</span>
            </td>
            <td>
              <div class="program-actions">
                <button class="btn btn-small" onclick="editProgram('${program.id}')">ç·¨è¼¯</button>
                <button class="btn btn-small btn-secondary" onclick="deleteProgram('${program.id}')">åˆªé™¤</button>
              </div>
            </td>
          </tr>
        `;
      });
      
      html += '</tbody></table>';
      
      // æ·»åŠ åˆ†é 
      const totalPages = Math.ceil(filteredPrograms.length / itemsPerPage);
      if (totalPages > 1) {
        html += '<div class="pagination">';
        for (let i = 1; i <= totalPages; i++) {
          html += `<button class="${i === currentPage ? 'active' : ''}" onclick="goToPage(${i})">${i}</button>`;
        }
        html += '</div>';
      }
      
      container.innerHTML = html;
    }
    
    // ç²å–ç‹€æ…‹æ–‡å­—
    function getStatusText(status) {
      const statusMap = {
        'archived': 'å·²æ­¸æª”',
        'popular': 'ç†±é–€',
        'recommended': 'æ¨è–¦'
      };
      return statusMap[status] || status;
    }
    
    // å¥—ç”¨ç¯©é¸
    function applyFilters() {
      const country = document.getElementById('filter-country').value;
      const category = document.getElementById('filter-category').value;
      const status = document.getElementById('filter-status').value;
      const rating = parseInt(document.getElementById('filter-rating').value);
      
      filteredPrograms = archivedPrograms.filter(program => {
        if (country && program.country !== country) return false;
        if (category && program.category !== category) return false;
        if (status && program.status !== status) return false;
        if (rating && program.rating < rating) return false;
        return true;
      });
      
      currentPage = 1;
      renderPrograms();
      showStatus(`ç¯©é¸å®Œæˆï¼Œæ‰¾åˆ° ${filteredPrograms.length} å€‹ç¯€ç›®`, 'success');
    }
    
    // æ¸…é™¤ç¯©é¸
    function clearFilters() {
      document.getElementById('filter-country').value = '';
      document.getElementById('filter-category').value = '';
      document.getElementById('filter-status').value = '';
      document.getElementById('filter-rating').value = '0';
      
      filteredPrograms = [...archivedPrograms];
      currentPage = 1;
      renderPrograms();
      showStatus('ç¯©é¸å·²æ¸…é™¤', 'info');
    }
    
    // åŸ·è¡Œè‡ªå‹•æ­¸æª”
    async function runAutoArchive() {
      try {
        showStatus('åŸ·è¡Œè‡ªå‹•æ­¸æª”ä¸­...', 'info');
        // é€™è£¡æ‡‰è©²èª¿ç”¨è‡ªå‹•æ­¸æª”é‚è¼¯
        await new Promise(resolve => setTimeout(resolve, 2000)); // æ¨¡æ“¬è™•ç†æ™‚é–“
        showStatus('è‡ªå‹•æ­¸æª”å®Œæˆ', 'success');
        loadArchivedPrograms(); // é‡æ–°è¼‰å…¥æ•¸æ“š
      } catch (error) {
        showStatus('è‡ªå‹•æ­¸æª”å¤±æ•—: ' + error.message, 'error');
      }
    }
    
    // åŒ¯å‡ºè³‡æ–™
    function exportData() {
      const dataStr = JSON.stringify(filteredPrograms, null, 2);
      const dataBlob = new Blob([dataStr], {type: 'application/json'});
      const url = URL.createObjectURL(dataBlob);
      const link = document.createElement('a');
      link.href = url;
      link.download = `archived-programs-${new Date().toISOString().split('T')[0]}.json`;
      link.click();
      URL.revokeObjectURL(url);
      showStatus('è³‡æ–™åŒ¯å‡ºå®Œæˆ', 'success');
    }
    
    // ç·¨è¼¯ç¯€ç›®
    function editProgram(programId) {
      const program = archivedPrograms.find(p => p.id === programId);
      if (!program) return;
      
      document.getElementById('edit-title').value = program.title;
      document.getElementById('edit-country').value = program.country;
      document.getElementById('edit-category').value = program.category;
      document.getElementById('edit-subcategory').value = program.subCategory;
      document.getElementById('edit-status').value = program.status;
      document.getElementById('edit-rating').value = program.rating;
      document.getElementById('edit-views').value = program.viewCount;
      document.getElementById('edit-favorites').value = program.favoriteCount;
      
      document.getElementById('editForm').onsubmit = function(e) {
        e.preventDefault();
        saveProgram(programId);
      };
      
      document.getElementById('editModal').style.display = 'block';
    }
    
    // ä¿å­˜ç¯€ç›®
    async function saveProgram(programId) {
      try {
        const program = archivedPrograms.find(p => p.id === programId);
        if (!program) return;
        
        // æ›´æ–°ç¯€ç›®æ•¸æ“š
        program.title = document.getElementById('edit-title').value;
        program.country = document.getElementById('edit-country').value;
        program.category = document.getElementById('edit-category').value;
        program.subCategory = document.getElementById('edit-subcategory').value;
        program.status = document.getElementById('edit-status').value;
        program.rating = parseFloat(document.getElementById('edit-rating').value);
        program.viewCount = parseInt(document.getElementById('edit-views').value);
        program.favoriteCount = parseInt(document.getElementById('edit-favorites').value);
        
        // é€™è£¡æ‡‰è©²èª¿ç”¨ API ä¿å­˜åˆ° Contentful
        // await contentful.updateEntry(programId, program);
        
        closeModal();
        updateStatistics();
        renderPrograms();
        showStatus('ç¯€ç›®æ›´æ–°æˆåŠŸ', 'success');
      } catch (error) {
        showStatus('æ›´æ–°å¤±æ•—: ' + error.message, 'error');
      }
    }
    
    // åˆªé™¤ç¯€ç›®
    async function deleteProgram(programId) {
      if (!confirm('ç¢ºå®šè¦åˆªé™¤é€™å€‹ç¯€ç›®å—ï¼Ÿ')) return;
      
      try {
        // é€™è£¡æ‡‰è©²èª¿ç”¨ API åˆªé™¤
        // await contentful.deleteEntry(programId);
        
        archivedPrograms = archivedPrograms.filter(p => p.id !== programId);
        filteredPrograms = filteredPrograms.filter(p => p.id !== programId);
        
        updateStatistics();
        renderPrograms();
        showStatus('ç¯€ç›®åˆªé™¤æˆåŠŸ', 'success');
      } catch (error) {
        showStatus('åˆªé™¤å¤±æ•—: ' + error.message, 'error');
      }
    }
    
    // é—œé–‰æ¨¡æ…‹æ¡†
    function closeModal() {
      document.getElementById('editModal').style.display = 'none';
    }
    
    // é¡¯ç¤ºç‹€æ…‹è¨Šæ¯
    function showStatus(message, type) {
      const statusEl = document.getElementById('status');
      statusEl.textContent = message;
      statusEl.className = `status ${type}`;
      statusEl.style.display = 'block';
      
      setTimeout(() => {
        statusEl.style.display = 'none';
      }, 3000);
    }
    
    // åˆ†é åŠŸèƒ½
    function goToPage(page) {
      currentPage = page;
      renderPrograms();
    }
    
    // æ‰¹é‡ç·¨è¼¯ï¼ˆå¾…å¯¦ç¾ï¼‰
    function showBulkEdit() {
      alert('æ‰¹é‡ç·¨è¼¯åŠŸèƒ½é–‹ç™¼ä¸­...');
    }
  </script>
</body>
</html>
