<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>å·²ä¸Šæ¶ç¯€ç›®ç®¡ç†</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; background: #f5f5f5; }
    
    .container { max-width: 1200px; margin: 0 auto; padding: 20px; }
    
    .header { background: white; padding: 20px; border-radius: 10px; margin-bottom: 20px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
    .header h1 { color: #2b71d2; margin-bottom: 10px; }
    
    .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-bottom: 30px; }
    .stat-card { background: white; padding: 20px; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); text-align: center; }
    .stat-number { font-size: 2rem; font-weight: 600; color: #2b71d2; margin-bottom: 5px; }
    .stat-label { color: #666; font-size: 0.9rem; }
    
    .controls { background: white; padding: 20px; border-radius: 10px; margin-bottom: 20px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
    .filter-group { display: flex; gap: 15px; align-items: center; margin-bottom: 15px; }
    .filter-group label { font-weight: 600; color: #333; }
    .filter-group select, .filter-group input { padding: 8px 12px; border: 1px solid #ddd; border-radius: 5px; }
    
    .programs-table { background: white; border-radius: 10px; overflow: hidden; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
    .table-header { background: #2b71d2; color: white; padding: 15px; display: grid; grid-template-columns: 1fr 1fr 1fr 1fr 1fr 1fr auto; gap: 15px; font-weight: 600; }
    .table-row { padding: 15px; display: grid; grid-template-columns: 1fr 1fr 1fr 1fr 1fr 1fr auto; gap: 15px; border-bottom: 1px solid #eee; align-items: center; }
    .table-row:hover { background: #f8f9fa; }
    .table-row:last-child { border-bottom: none; }
    
    .status-badge { padding: 4px 8px; border-radius: 4px; font-size: 0.8rem; font-weight: 600; }
    .status-published { background: #d4edda; color: #155724; }
    .status-draft { background: #fff3cd; color: #856404; }
    .status-error { background: #f8d7da; color: #721c24; }
    
    .btn { background: #2b71d2; color: white; padding: 8px 15px; border: none; border-radius: 5px; cursor: pointer; font-size: 0.9rem; }
    .btn:hover { background: #1e5bb8; }
    .btn-secondary { background: #6c757d; }
    .btn-secondary:hover { background: #5a6268; }
    .btn-danger { background: #dc3545; }
    .btn-danger:hover { background: #c82333; }
    
    .empty-state { text-align: center; padding: 60px 20px; color: #666; }
    .empty-state h3 { margin-bottom: 10px; color: #333; }
    
    .back-btn { background: #6c757d; color: white; padding: 10px 20px; border: none; border-radius: 5px; cursor: pointer; text-decoration: none; display: inline-block; margin-bottom: 20px; }
    .back-btn:hover { background: #5a6268; }
  </style>
</head>
<body>
  <div class="container">
    <a href="admin-dashboard.html" class="back-btn">â† è¿”å›å„€è¡¨æ¿</a>
    
    <div class="header">
      <h1>ğŸ“º å·²ä¸Šæ¶ç¯€ç›®ç®¡ç†</h1>
      <p>æŸ¥çœ‹å’Œç®¡ç†æ‰€æœ‰å·²ä¸Šæ¶åˆ° Contentful çš„ç¯€ç›®</p>
    </div>
    
    <div class="stats-grid">
      <div class="stat-card">
        <div class="stat-number" id="totalPrograms">0</div>
        <div class="stat-label">ç¸½ç¯€ç›®æ•¸</div>
      </div>
      <div class="stat-card">
        <div class="stat-number" id="publishedToday">0</div>
        <div class="stat-label">ä»Šæ—¥ä¸Šæ¶</div>
      </div>
      <div class="stat-card">
        <div class="stat-number" id="thisWeek">0</div>
        <div class="stat-label">æœ¬é€±ä¸Šæ¶</div>
      </div>
      <div class="stat-card">
        <div class="stat-number" id="thisMonth">0</div>
        <div class="stat-label">æœ¬æœˆä¸Šæ¶</div>
      </div>
    </div>
    
    <div class="controls">
      <div class="filter-group">
        <label>åˆ†é¡ç¯©é¸ï¼š</label>
        <select id="categoryFilter">
          <option value="">å…¨éƒ¨åˆ†é¡</option>
          <option value="äºæ´²æ—…éŠ">äºæ´²æ—…éŠ</option>
          <option value="æ­æ´²æ—…éŠ">æ­æ´²æ—…éŠ</option>
          <option value="ç¾æ´²æ—…éŠ">ç¾æ´²æ—…éŠ</option>
          <option value="ç¾é£Ÿæ—…éŠ">ç¾é£Ÿæ—…éŠ</option>
          <option value="æ¥µåœ°æ—…éŠ">æ¥µåœ°æ—…éŠ</option>
          <option value="è‡ªç„¶æ—…éŠ">è‡ªç„¶æ—…éŠ</option>
          <option value="æ–‡åŒ–æ—…éŠ">æ–‡åŒ–æ—…éŠ</option>
          <option value="å†’éšªæ—…éŠ">å†’éšªæ—…éŠ</option>
        </select>
        
        <label>ç‹€æ…‹ç¯©é¸ï¼š</label>
        <select id="statusFilter">
          <option value="">å…¨éƒ¨ç‹€æ…‹</option>
          <option value="é¦–æ’­">é¦–æ’­</option>
          <option value="é‡æ’­">é‡æ’­</option>
          <option value="ç‰¹åˆ¥ç¯€ç›®">ç‰¹åˆ¥ç¯€ç›®</option>
        </select>
        
        <label>æ—¥æœŸç¯„åœï¼š</label>
        <input type="date" id="startDate">
        <span>è‡³</span>
        <input type="date" id="endDate">
        
        <button class="btn" onclick="applyFilters()">ç¯©é¸</button>
        <button class="btn btn-secondary" onclick="clearFilters()">æ¸…é™¤ç¯©é¸</button>
      </div>
    </div>
    
    <div class="programs-table">
      <div class="table-header">
        <div>ç¯€ç›®æ¨™é¡Œ</div>
        <div>æ’­å‡ºæ—¥æœŸ</div>
        <div>æ’­å‡ºæ™‚é–“</div>
        <div>åˆ†é¡</div>
        <div>ç‹€æ…‹</div>
        <div>ä¸Šæ¶æ™‚é–“</div>
        <div>æ“ä½œ</div>
      </div>
      <div id="programsList">
        <div class="empty-state">
          <h3>ğŸ“­ å°šç„¡å·²ä¸Šæ¶ç¯€ç›®</h3>
          <p>è«‹å…ˆåœ¨çµ±ä¸€ç¯€ç›®ç®¡ç†ç³»çµ±ä¸­ä¸Šæ¶ç¯€ç›®</p>
        </div>
      </div>
    </div>
  </div>

  <script>
    let allPrograms = [];
    let filteredPrograms = [];
    
    document.addEventListener('DOMContentLoaded', function() {
      loadPublishedPrograms();
      updateStats();
      renderProgramsList();
    });
    
    function loadPublishedPrograms() {
      const published = localStorage.getItem('published_programs');
      allPrograms = published ? JSON.parse(published) : [];
      filteredPrograms = [...allPrograms];
    }
    
    function updateStats() {
      const today = new Date().toISOString().split('T')[0];
      const now = new Date();
      const weekStart = new Date(now.getTime() - (now.getDay() * 24 * 60 * 60 * 1000));
      const monthStart = new Date(now.getFullYear(), now.getMonth(), 1);
      
      document.getElementById('totalPrograms').textContent = allPrograms.length;
      document.getElementById('publishedToday').textContent = allPrograms.filter(p => p.airDate === today).length;
      document.getElementById('thisWeek').textContent = allPrograms.filter(p => new Date(p.airDate) >= weekStart).length;
      document.getElementById('thisMonth').textContent = allPrograms.filter(p => new Date(p.airDate) >= monthStart).length;
    }
    
    function renderProgramsList() {
      const list = document.getElementById('programsList');
      
      if (filteredPrograms.length === 0) {
        list.innerHTML = `
          <div class="empty-state">
            <h3>ğŸ“­ æ²’æœ‰ç¬¦åˆæ¢ä»¶çš„ç¯€ç›®</h3>
            <p>è«‹èª¿æ•´ç¯©é¸æ¢ä»¶æˆ–å…ˆä¸Šæ¶ç¯€ç›®</p>
          </div>
        `;
        return;
      }
      
      list.innerHTML = filteredPrograms.map(program => `
        <div class="table-row">
          <div>
            <strong>${program.title}</strong>
            ${program.description ? `<br><small style="color: #666;">${program.description}</small>` : ''}
          </div>
          <div>${formatDate(program.airDate)}</div>
          <div>${program.airTime}</div>
          <div>${program.category}</div>
          <div>
            <span class="status-badge status-published">${program.status}</span>
          </div>
          <div>${formatDateTime(program.publishedAt)}</div>
          <div>
            <button class="btn btn-secondary" onclick="viewProgram('${program.airDate}', '${program.airTime}')">æŸ¥çœ‹</button>
            <button class="btn btn-danger" onclick="unpublishProgram('${program.airDate}', '${program.airTime}')">ä¸‹æ¶</button>
          </div>
        </div>
      `).join('');
    }
    
    function applyFilters() {
      const category = document.getElementById('categoryFilter').value;
      const status = document.getElementById('statusFilter').value;
      const startDate = document.getElementById('startDate').value;
      const endDate = document.getElementById('endDate').value;
      
      filteredPrograms = allPrograms.filter(program => {
        if (category && program.category !== category) return false;
        if (status && program.status !== status) return false;
        if (startDate && program.airDate < startDate) return false;
        if (endDate && program.airDate > endDate) return false;
        return true;
      });
      
      renderProgramsList();
    }
    
    function clearFilters() {
      document.getElementById('categoryFilter').value = '';
      document.getElementById('statusFilter').value = '';
      document.getElementById('startDate').value = '';
      document.getElementById('endDate').value = '';
      
      filteredPrograms = [...allPrograms];
      renderProgramsList();
    }
    
    function viewProgram(date, time) {
      // è·³è½‰åˆ°çµ±ä¸€ç¯€ç›®ç®¡ç†ç³»çµ±æŸ¥çœ‹è©²ç¯€ç›®
      window.open(`admin-calendar-unified.html?date=${date}&time=${time}`, '_blank');
    }
    
    function unpublishProgram(date, time) {
      if (confirm('ç¢ºå®šè¦ä¸‹æ¶é€™å€‹ç¯€ç›®å—ï¼Ÿ')) {
        // å¾å·²ä¸Šæ¶åˆ—è¡¨ä¸­ç§»é™¤
        allPrograms = allPrograms.filter(p => !(p.airDate === date && p.airTime === time));
        localStorage.setItem('published_programs', JSON.stringify(allPrograms));
        
        // æ›´æ–°æœ¬åœ°ç¯€ç›®ç‹€æ…‹
        const events = JSON.parse(localStorage.getItem('calendar_events') || '{}');
        const dateEvents = events[date] || [];
        const updatedEvents = dateEvents.map(event => {
          if (event.time === time) {
            event.published = false;
            delete event.publishedAt;
          }
          return event;
        });
        events[date] = updatedEvents;
        localStorage.setItem('calendar_events', JSON.stringify(events));
        
        loadPublishedPrograms();
        updateStats();
        renderProgramsList();
        
        alert('ç¯€ç›®å·²ä¸‹æ¶');
      }
    }
    
    function formatDate(dateString) {
      const date = new Date(dateString);
      return date.toLocaleDateString('zh-TW');
    }
    
    function formatDateTime(dateTimeString) {
      const date = new Date(dateTimeString);
      return date.toLocaleString('zh-TW');
    }
  </script>
</body>
</html>
